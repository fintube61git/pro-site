<!doctype html>
<html lang="en" data-theme="auto">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>CV | T. Dawson Woodrum, PhD</title>
  <meta name="description" content="Curriculum vitae for T. Dawson Woodrum, PhD, including publications and presentations.">
  <link rel="canonical" href="https://www.tdawsonwoodrum.com/cv/">
  <meta property="og:type" content="website">
  <meta property="og:title" content="CV | T. Dawson Woodrum, PhD">
  <meta property="og:description" content="Curriculum vitae including publications and presentations.">
  <meta property="og:url" content="https://www.tdawsonwoodrum.com/cv/">
  <meta property="og:image" content="https://www.tdawsonwoodrum.com/assets/img/og-default.png">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="CV | T. Dawson Woodrum, PhD">
  <meta name="twitter:description" content="Curriculum vitae including publications and presentations.">
  <meta name="twitter:image" content="https://www.tdawsonwoodrum.com/assets/img/og-default.png">
  <link rel="stylesheet" href="../css/styles.v2.css">
  <link rel="icon" href="../assets/img/favicon.ico" type="image/x-icon">
</head>
<body>
  <main id="main" class="section">
    <div class="container">
      <article id="cv-content" aria-live="polite">Loading CV...</article>
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script>
    (function () {
      function slugify(text) {
        return text
          .toLowerCase()
          .trim()
          .replace(/<[^>]*>/g, "")
          .replace(/&[a-z0-9#]+;/gi, "")
          .replace(/[^a-z0-9\s-]/g, "")
          .replace(/\s+/g, "-")
          .replace(/-+/g, "-");
      }

      function applyHeadingIds(root) {
        const seen = Object.create(null);
        const headings = root.querySelectorAll("h1, h2, h3, h4, h5, h6");
        headings.forEach(function (h) {
          if (h.id) return;
          const base = slugify(h.textContent || "") || "section";
          const count = seen[base] || 0;
          seen[base] = count + 1;
          h.id = count ? base + "-" + count : base;
        });
      }

      function applyKnownSectionIds(root) {
        const headings = root.querySelectorAll("h1, h2, h3, h4, h5, h6");
        headings.forEach(function (h) {
          const t = (h.textContent || "").trim().toLowerCase();
          if (t === "publications") h.id = "publications";
          if (t === "presentations") h.id = "presentations";
        });
      }

      function scrollToHash() {
        if (!location.hash) return;
        const id = decodeURIComponent(location.hash.slice(1));
        const target = document.getElementById(id);
        if (target) target.scrollIntoView();
      }

      async function renderCv() {
        const root = document.getElementById("cv-content");
        try {
          async function fetchText(path) {
            const res = await fetch(path, { cache: "no-store" });
            if (!res.ok) throw new Error("Failed to fetch " + path + " (" + res.status + ")");
            return res.text();
          }

          async function fetchFromCandidates(paths) {
            let lastErr = null;
            for (const p of paths) {
              try {
                return await fetchText(p);
              } catch (err) {
                lastErr = err;
              }
            }
            throw lastErr || new Error("Unable to fetch from candidates.");
          }

          const includePattern = /^\s*\{\{<\s*include\s+([^>\r\n]+)\s*>\}\}\s*$/;
          const md = await fetchFromCandidates(["/cv.md", "../cv.md"]);
          const lines = md.split(/\r?\n/);
          const expanded = [];

          for (const line of lines) {
            const m = line.match(includePattern);
            if (!m) {
              expanded.push(line);
              continue;
            }

            const relPath = m[1].trim().replace(/\\/g, "/");
            const includeText = await fetchFromCandidates([
              "/" + relPath.replace(/^\/+/, ""),
              "../" + relPath.replace(/^\/+/, "")
            ]);
            expanded.push(includeText);
          }

          const expandedMd = expanded.join("\n");
          marked.setOptions({ gfm: true, breaks: false });
          root.innerHTML = marked.parse(expandedMd);
          applyHeadingIds(root);
          applyKnownSectionIds(root);
          scrollToHash();
          setTimeout(scrollToHash, 120);
        } catch (err) {
          root.textContent = "Could not load CV markdown.";
          console.error(err);
        }
      }

      renderCv();
      window.addEventListener("hashchange", scrollToHash);
    })();
  </script>
</body>
</html>
